<!-- Shared Head -->
    <div id="shared-head"></div>

</head>
<body class="bg-dark-bg">

    <!-- Shared Header -->
    <div id="shared-header"></div>

    <main class="pt-20">
        <header class="py-16 bg-dark-bg text-center animate-fade-in">
            <div class="container mx-auto px-4">
                <h1 class="text-4xl md:text-6xl font-extrabold mb-4">Unser <span class="neon-text">Blog & Archiv</span></h1>
                <p class="text-xl text-subtle-gray max-w-3xl mx-auto">Alle Artikel, Guides und News rund um Freiburg. Inspiration, Geheimtipps und mehr!</p>
            </div>
        </header>

        <div class="container mx-auto px-4 py-12">
            <!-- Dieser Container wird die Blog-Übersicht oder den einzelnen Artikel anzeigen -->
            <div id="blog-content-container">
                <section id="all-articles" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 animate-fade-in-up"></section>
                <section id="blog-article-full" class="max-w-4xl mx-auto hidden animate-fade-in"></section>
            </div>
        </div>
    </main>

    <!-- Shared Footer -->
    <div id="shared-footer"></div>

    <!-- Shared Scripts -->
    <div id="shared-scripts"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const articlesList = [
            "content/articles/neu-in-freiburg-guide.md",
            "content/articles/therme-freiburg-vergleich.md",
            "content/articles/vintage-secondhand-freiburg.md",
            "content/articles/wandern-geheimtipps-freiburg.md",
            "content/articles/weinfest-freiburg-guide.md",
            "content/articles/zmf-freiburg-guide.md"
        ];

        const overviewContainer = document.getElementById('all-articles');
        const articleContainer = document.getElementById('blog-article-full');
        const defaultTitle = "Blog & Archiv | Freiburg Vibe";
        const defaultDescription = "Alle Blog-Artikel, Guides und News aus Freiburg. Insider-Tipps, Erfahrungsberichte, Food, Events und mehr.";

        function getQueryParam(name) {
            return new URL(window.location.href).searchParams.get(name);
        }

        function updateMetaTags(title, description, url) {
            document.title = title;
            document.querySelector('meta[name="description"]').setAttribute('content', description);
            document.querySelector('link[rel="canonical"]').setAttribute('href', url);
            document.querySelector('meta[property="og:title"]').setAttribute('content', title);
            document.querySelector('meta[property="og:description"]').setAttribute('content', description);
            document.querySelector('meta[property="og:url"]').setAttribute('content', url);
        }

        function setSchema(schema) {
            let schemaTag = document.querySelector('script[type="application/ld+json"]');
            if (!schemaTag) {
                schemaTag = document.createElement('script');
                schemaTag.type = 'application/ld+json';
                document.head.appendChild(schemaTag);
            }
            schemaTag.textContent = JSON.stringify(schema);
        }

        async function loadBlogArticle(file) {
            overviewContainer.style.display = 'none';
            articleContainer.style.display = 'block';
            articleContainer.innerHTML = `<div class='text-center text-subtle-gray p-10'>Lade Artikel...</div>`;

            try {
                const res = await fetch(file);
                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                const text = await res.text();

                const titleMatch = text.match(/^# (.+)/m);
                const title = titleMatch ? titleMatch[1] : "Unbenannter Artikel";
                const content = titleMatch ? text.substring(titleMatch[0].length).trim() : text;
                const preview = content.substring(0, 160).replace(/\s+/g, ' ').trim() + "...";
                const articleUrl = `${window.location.origin}${window.location.pathname}?file=${encodeURIComponent(file)}`;

                updateMetaTags(`${title} | Freiburg Vibe`, preview, articleUrl);

                setSchema({
                    "@context": "https://schema.org",
                    "@type": "BlogPosting",
                    "headline": title,
                    "description": preview,
                    "image": "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Freiburg_Germany_Panorama_night_view_from_Schlossberg_2023.jpg/1200px-Freiburg_Germany_Panorama_night_view_from_Schlossberg_2023.jpg",
                    "author": {
                        "@type": "Organization",
                        "name": "FreiburgVibe"
                    },
                    "publisher": {
                        "@type": "Organization",
                        "name": "FreiburgVibe",
                        "logo": {
                            "@type": "ImageObject",
                            "url": "https://www.freiburg-vibe.de/img/logo.png" // Annahme: Logo-URL
                        }
                    },
                    "mainEntityOfPage": {
                        "@type": "WebPage",
                        "@id": articleUrl
                    }
                });

                let htmlContent = content
                    .replace(/^###\s(.+)/gm, '<h3 class="text-2xl font-bold mt-8 mb-4 text-light-text">$1</h3>')
                    .replace(/^##\s(.+)/gm, '<h2 class="text-3xl font-bold mt-10 mb-6 text-light-text">$1</h2>')
                    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                    .replace(/__(.+?)__/g, '<strong>$1</strong>')
                    .replace(/\*(.+?)\*/g, '<em>$1</em>')
                    .replace(/_(.+?)_/g, '<em>$1</em>')
                    .replace(/\[(.+?)\]\((.+?)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer" class="text-neon-purple hover:underline">$1</a>')
                    .split(/\n\s*\n/).map(p => `<p class="mb-5 leading-relaxed">${p.replace(/\n/g, '<br>')}</p>`).join('');

                articleContainer.innerHTML = `
                    <article class="bg-dark-card p-6 md:p-10 rounded-2xl shadow-lg">
                        <header>
                            <h1 class="text-3xl md:text-5xl font-extrabold mb-4 text-light-text">${title}</h1>
                            <p class="text-subtle-gray mb-8">Veröffentlicht am ${new Date().toLocaleDateString('de-DE', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        </header>
                        <div class="article-content text-subtle-gray text-lg">
                            ${htmlContent}
                        </div>
                        <a href="blog.html" class="ripple-btn mt-10 inline-block text-neon-purple font-semibold text-lg">
                            <i class="fas fa-arrow-left text-sm mr-2"></i> Zurück zur Übersicht
                        </a>
                    </article>
                `;
            } catch (e) {
                console.error("Fehler beim Laden des Artikels:", e);
                articleContainer.innerHTML = `<div class='text-center text-neon-purple p-10'>Artikel konnte nicht geladen werden. Bitte versuche es später erneut.</div>`;
            }
        }

        async function showBlogOverview() {
            articleContainer.style.display = 'none';
            overviewContainer.style.display = 'grid';
            overviewContainer.innerHTML = `<div class='text-center text-subtle-gray col-span-full'>Lade Artikel...</div>`;
            
            updateMetaTags(defaultTitle, defaultDescription, window.location.origin + window.location.pathname);
            setSchema({
                "@context": "https://schema.org",
                "@type": "Blog",
                "name": "Freiburg Vibe Blog",
                "url": window.location.origin + window.location.pathname,
                "description": defaultDescription
            });

            let html = "";
            for (const file of articlesList.slice().reverse()) {
                try {
                    const res = await fetch(file);
                    if (!res.ok) continue;
                    const text = await res.text();
                    
                    const title = (text.match(/^# (.+)/m) || [])[1] || "Blog-Artikel";
                    const preview = text.substring(title.length).trim().substring(0, 120).replace(/\s+/g, ' ').trim() + "...";

                    html += `
                    <article class="service-card rounded-2xl overflow-hidden shadow-lg h-full flex flex-col bg-dark-card transform hover:-translate-y-2 transition-transform duration-300">
                        <div class="p-6 flex flex-col flex-grow">
                            <h3 class="text-2xl font-bold mb-3 text-light-text">${title}</h3>
                            <p class="text-subtle-gray flex-grow mb-5">${preview}</p>
                            <a href="?file=${encodeURIComponent(file)}" class="ripple-btn mt-auto text-neon-purple font-semibold self-start text-lg">
                                Weiterlesen <i class="fas fa-arrow-right text-sm ml-1"></i>
                            </a>
                        </div>
                    </article>`;
                } catch(e) {
                    console.error("Fehler beim Laden der Vorschau für:", e);
                }
            }
            overviewContainer.innerHTML = html || "<p class='text-subtle-gray col-span-full text-center'>Keine Artikel gefunden.</p>";
        }

        function handleRouting() {
            const fileToLoad = getQueryParam('file');
            if (fileToLoad) {
                loadBlogArticle(fileToLoad);
            } else {
                showBlogOverview();
            }
        }

        window.addEventListener('popstate', handleRouting);
        handleRouting();
    });
    </script>

    <script>
        // Use fetch to load shared components
        fetch('shared-head.html').then(response => response.text()).then(data => document.getElementById('shared-head').innerHTML = data);
        fetch('shared-header.html').then(response => response.text()).then(data => document.getElementById('shared-header').innerHTML = data);
        fetch('shared-footer.html').then(response => response.text()).then(data => document.getElementById('shared-footer').innerHTML = data);
        fetch('shared-scripts.html').then(response => response.text()).then(data => {
            const script = document.createElement('script');
            script.innerHTML = data;
            document.body.appendChild(script);
        });
    </script>

</body>
</html>
